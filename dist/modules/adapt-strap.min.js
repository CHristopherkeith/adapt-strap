/**
 * adapt-strap
 * @version v0.1.8 - 2014-08-01
 * @link https://github.com/Adaptv/adapt-strap
 * @author Kashyap Patel (kashyap@adap.tv)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,e,t){"use strict";angular.module("adaptv.adaptStrap",["adaptv.adaptStrap.utils","adaptv.adaptStrap.treebrowser","adaptv.adaptStrap.tablelite","adaptv.adaptStrap.tableajax","adaptv.adaptStrap.loadingindicator"]).provider("$adConfig",function(){var a=this.iconClasses={expand:"glyphicon glyphicon-plus-sign",collapse:"glyphicon glyphicon-minus-sign",loadingSpinner:"glyphicon glyphicon-refresh ad-spin"},e=this.paging={request:{start:"skip",pageSize:"limit",page:"page"},response:{itemsLocation:"data",totalItems:"pagination.totalCount"}};this.$get=function(){return{iconClasses:a,paging:e}}}),angular.module("adaptv.adaptStrap.loadingindicator",[]).directive("adLoadingIcon",["$adConfig","$compile",function(a,e){return{restrict:"E",compile:function(){return{pre:function(t,n,i){var l=i.loadingIconClass||a.iconClasses.loadingSpinner,o=i.loadingIconSize?"ng-style=\"{'font-size': '"+i.loadingIconSize+"'}\"":"",g='<i class="'+l+'" '+o+"></i>";n.html(e(g)(t))}}}}}]).directive("adLoadingOverlay",["$adConfig",function(a){return{restrict:"E",templateUrl:"loadingindicator/loadingindicator.tpl.html",scope:{loading:"=",zIndex:"@",position:"@",containerClasses:"@",loadingIconClass:"@",loadingIconSize:"@"},compile:function(){return{pre:function(e){e.loadingIconClass=e.loadingIconClass||a.iconClasses.loading,e.loadingIconSize=e.loadingIconSize||"3em"}}}}}]),angular.module("adaptv.adaptStrap.tableajax",["adaptv.adaptStrap.utils","adaptv.adaptStrap.loadingindicator"]).directive("adTableAjax",["$parse","$compile","$templateCache","adLoadPage","adDebounce","adStrapUtils",function(a,e,n,i,l,o){function g(g,r,s){g[s.tableName]={items:{list:t,paging:{currentPage:1,totalPages:t,pageSize:t,pageSizes:a(s.pageSizes)()||[10,25,50]}},localConfig:{pagingArray:[],loadingData:!1},ajaxConfig:g.$eval(s.ajaxConfig),applyFilter:o.applyFilter};var p,c=g[s.tableName],d=n.get("tableajax/tableajax.tpl.html");c.items.paging.pageSize=c.items.paging.pageSizes[0],c.loadPage=l(function(a){p=Math.random(),c.localConfig.loadingData=!0,i(a,c.items.paging.pageSize,c.ajaxConfig,p).then(function(a){a.identityToken===p&&(c.items.list=a.items,c.items.paging.totalPages=a.totalPages,c.items.paging.currentPage=a.currentPage,c.localConfig.pagingArray=a.pagingArray,c.localConfig.loadingData=!1)},function(){c.localConfig.loadingData=!1})}),c.loadNextPage=function(){c.localConfig.loadingData||c.items.paging.currentPage+1<=c.items.paging.totalPages&&c.loadPage(c.items.paging.currentPage+1)},c.loadPreviousPage=function(){c.localConfig.loadingData||c.items.paging.currentPage-1>0&&c.loadPage(c.items.paging.currentPage-1)},c.loadLastPage=function(){c.localConfig.loadingData||c.items.paging.currentPage!==c.items.paging.totalPages&&c.loadPage(c.items.paging.totalPages)},c.pageSizeChanged=function(a){Number(a)!==c.items.paging.pageSize&&(c.items.paging.pageSize=Number(a),c.loadPage(1))},c.loadPage(1),g.$watch(s.ajaxConfig,function(){c.loadPage(1)},!0),s.tableClasses=s.tableClasses||"table",s.paginationBtnGroupClasses=s.paginationBtnGroupClasses||"btn-group btn-group-sm",d=d.replace(/%=tableName%/g,s.tableName).replace(/%=columnDefinition%/g,s.columnDefinition).replace(/%=tableClasses%/g,s.tableClasses).replace(/%=paginationBtnGroupClasses%/g,s.paginationBtnGroupClasses),angular.element(r).html(e(d)(g))}return{restrict:"E",link:g}}]),angular.module("adaptv.adaptStrap.tablelite",["adaptv.adaptStrap.utils"]).provider("$tablelite",function(){var a=this.defaults={expandIconClass:"glyphicon glyphicon-plus-sign",collapseIconClass:"glyphicon glyphicon-minus-sign",loadingIconClass:"glyphicon glyphicon-refresh ad-spin"};this.$get=function(){return{settings:a}}}).directive("adTableLite",["$parse","$http","$compile","$filter","$templateCache","adStrapUtils","adDebounce",function(a,e,n,i,l,o,g){function r(e,r,s){e[s.tableName]={items:{list:t,paging:{currentPage:1,totalPages:t,pageSize:t,pageSizes:a(s.pageSizes)()||[10,25,50]}},localConfig:{pagingArray:[]},applyFilter:o.applyFilter};var p=e[s.tableName],c=l.get("tablelite/tablelite.tpl.html");p.items.paging.pageSize=p.items.paging.pageSizes[0],p.loadPage=g(function(a){var t,n,l=(a-1)*p.items.paging.pageSize,o=l+p.items.paging.pageSize,g=i("orderBy")(e.$eval(s.localDataSource),p.localConfig.predicate,p.localConfig.reverse);for(p.items.list=g.slice(l,o),p.items.paging.currentPage=a,p.items.paging.totalPages=Math.ceil(e.$eval(s.localDataSource).length/p.items.paging.pageSize),p.localConfig.pagingArray=[],n=Math.ceil(a/p.items.paging.pageSize)*p.items.paging.pageSize-(p.items.paging.pageSize-1),t=0;5>t;t++)n+t>0&&n+t<=p.items.paging.totalPages&&p.localConfig.pagingArray.push(n+t)}),p.loadNextPage=function(){p.items.paging.currentPage+1<=p.items.paging.totalPages&&p.loadPage(p.items.paging.currentPage+1)},p.loadPreviousPage=function(){p.items.paging.currentPage-1>0&&p.loadPage(p.items.paging.currentPage-1)},p.loadLastPage=function(){p.localConfig.disablePaging||p.loadPage(p.items.paging.totalPages)},p.pageSizeChanged=function(a){p.items.paging.pageSize=a,p.loadPage(1)},p.sortByColumn=function(a){a.sortable&&(p.localConfig.predicate=a.displayProperty,p.localConfig.reverse=!p.localConfig.reverse,p.loadPage(p.items.paging.currentPage))},p.loadPage(1),s.tableClasses=s.tableClasses||"table",s.paginationBtnGroupClasses=s.paginationBtnGroupClasses||"btn-group btn-group-sm",c=c.replace(/%=tableName%/g,s.tableName).replace(/%=columnDefinition%/g,s.columnDefinition).replace(/%=paginationBtnGroupClasses%/g,s.paginationBtnGroupClasses).replace(/%=tableClasses%/g,s.tableClasses),angular.element(r).html(n(c)(e)),e.$watch(s.localDataSource,function(){p.loadPage(1)},!0)}return{restrict:"E",link:r}}]),angular.module("adaptv.adaptStrap.treebrowser",[]).directive("adTreeBrowser",["$compile","$http","$adConfig","$templateCache",function(a,e,t,n){return{restrict:"E",link:function(i,l,o){var g=o.treeName||"",r=o.nodeTemplateUrl||"",s=o.nodeHeaderUrl||"",p=o.childrenPadding||15,c="",d=function(e,r){var s=n.get("treebrowser/treebrowser.tpl.html");c=s.replace(/%=treeName%/g,g).replace(/%=treeRootName%/g,o.treeRoot).replace(/%=bordered%/g,o.bordered).replace(/%=expandIconClass%/g,o.expandIconClass||t.iconClasses.expand).replace(/%=collapseIconClass%/g,o.collapseIconClass||t.iconClasses.collapse).replace(/%=loadingIconClass%/g,o.loadingIconClass||t.iconClasses.loadingSpinner).replace(/%=childNodeName%/g,o.childNode).replace(/%=childrenPadding%/g,p).replace(/%=rowNgClass%/g,o.rowNgClass||"").replace(/%=nodeTemplate%/g,e).replace(/%=nodeHeaderTemplate%/g,r||""),l.empty(),l.append(a(c)(i))};i[g+"TreeBrowser"]={toggle:function(a,e){var t;a.stopPropagation(),t=i.$eval(o.toggleCallback),t?t(e):e._expanded=!e._expanded},hasChildren:function(a){var e=i.$eval(o.hasChildren),t=a[o.childNode]&&a[o.childNode].length>0;return e&&(t=e(a)),t},showHeader:""!==s?!0:!1},""!==r?e.get(r).success(function(a){""!==s?e.get(s).success(function(e){d(a,e)}):d(a,"")}):d('<span>{{ item.name || "" }}</span>')}}}]),angular.module("adaptv.adaptStrap.utils",[]).factory("adStrapUtils",["$filter",function(a){return{evalObjectProperty:function(a,e){var t=e.split(".");if(a)for(;t.length;)a&&(a=a[t.shift()]);return a},applyFilter:function(e,t){var n,i;return t&&(n=t.split(":"),i=n[1],e=i?a(n[0])(e,i):a(n[0])(e)),e}}}]).factory("adDebounce",["$timeout","$q",function(a,e){var t=function(t,n,i,l){var o=null,g=e.defer(),r=n||300;return function(){var n=l||this,s=arguments,p=i&&!o,c=function(){i||(g.resolve(t.apply(n,s)),g=e.defer())};return o&&a.cancel(o),o=a(c,r),p&&(g.resolve(t.apply(n,s)),g=e.defer()),g.promise}};return t}]).factory("adLoadPage",["$adConfig","$q","$http","adStrapUtils",function(a,e,t,n){return function(i,l,o,g){var r,s,p,c,d=(i-1)*l,u=e.defer(),m=angular.copy(a.paging),f=angular.copy(o);return f.paginationConfig&&f.paginationConfig.request&&angular.extend(m.request,f.paginationConfig.request),f.paginationConfig&&f.paginationConfig.response&&angular.extend(m.response,f.paginationConfig.response),f.params[m.request.start]=d,f.params[m.request.pageSize]=l,f.params[m.request.page]=i,p=function(a){var e={items:n.evalObjectProperty(a,m.response.itemsLocation),currentPage:i,totalPages:Math.ceil(n.evalObjectProperty(a,m.response.totalItems)/l),pagingArray:[],identityToken:g};for(s=Math.ceil(i/l)*l-(l-1),r=0;5>r;r++)s+r>0&&s+r<=e.totalPages&&e.pagingArray.push(s+r);u.resolve(e)},c=function(a){u.reject(a)},"JSONP"===f.method?t.jsonp(f.url+"?callback=JSON_CALLBACK",f).success(p).error(c):t(f).success(p).error(c),u.promise}}])}(window,document);