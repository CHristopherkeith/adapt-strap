/**
 * adapt-strap
 * @version v0.2.1 - 2014-08-05
 * @link https://github.com/Adaptv/adapt-strap
 * @author Kashyap Patel (kashyap@adap.tv)
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
!function(a,e,n){"use strict";angular.module("adaptv.adaptStrap",["adaptv.adaptStrap.utils","adaptv.adaptStrap.treebrowser","adaptv.adaptStrap.tablelite","adaptv.adaptStrap.tableajax","adaptv.adaptStrap.loadingindicator"]).provider("$adConfig",function(){var a=this.iconClasses={expand:"glyphicon glyphicon-plus-sign",collapse:"glyphicon glyphicon-minus-sign",loadingSpinner:"glyphicon glyphicon-refresh ad-spin",firstPage:"glyphicon glyphicon-fast-backward",previousPage:"glyphicon glyphicon-backward",nextPage:"glyphicon glyphicon-forward",lastPage:"glyphicon glyphicon-fast-forward",sortAscending:"glyphicon glyphicon-chevron-up",sortDescending:"glyphicon glyphicon-chevron-down",sortable:"glyphicon glyphicon-resize-vertical"},e=this.paging={request:{start:"skip",pageSize:"limit",page:"page",sortField:"sort",sortDirection:"sort_dir",sortAscValue:"asc",sortDescValue:"desc"},response:{itemsLocation:"data",totalItems:"pagination.totalCount"}};this.$get=function(){return{iconClasses:a,paging:e}}}),angular.module("adaptv.adaptStrap.loadingindicator",[]).directive("adLoadingIcon",["$adConfig","$compile",function(a,e){return{restrict:"E",compile:function(){return{pre:function(n,t,i){var o=i.loadingIconClass||a.iconClasses.loadingSpinner,r=i.loadingIconSize?"ng-style=\"{'font-size': '"+i.loadingIconSize+"'}\"":"",l='<i class="'+o+'" '+r+"></i>";t.empty(),t.append(e(l)(n))}}}}}]).directive("adLoadingOverlay",["$adConfig",function(a){return{restrict:"E",templateUrl:"loadingindicator/loadingindicator.tpl.html",scope:{loading:"=",zIndex:"@",position:"@",containerClasses:"@",loadingIconClass:"@",loadingIconSize:"@"},compile:function(){return{pre:function(e){e.loadingIconClass=e.loadingIconClass||a.iconClasses.loading,e.loadingIconSize=e.loadingIconSize||"3em"}}}}}]),angular.module("adaptv.adaptStrap.tableajax",["adaptv.adaptStrap.utils","adaptv.adaptStrap.loadingindicator"]).directive("adTableAjax",["$parse","$compile","$templateCache","$adConfig","adLoadPage","adDebounce","adStrapUtils",function(a,e,t,i,o,r,l){function g(g,s,p){g[p.tableName]={items:{list:n,paging:{currentPage:1,totalPages:n,pageSize:n,pageSizes:a(p.pageSizes)()||[10,25,50]}},localConfig:{pagingArray:[],loadingData:!1},ajaxConfig:g.$eval(p.ajaxConfig),applyFilter:l.applyFilter};var c,d=g[p.tableName],u=t.get("tableajax/tableajax.tpl.html");d.items.paging.pageSize=d.items.paging.pageSizes[0],d.loadPage=r(function(a){c=Math.random(),d.localConfig.loadingData=!0,o(a,d.items.paging.pageSize,{field:d.localConfig.predicate,reverse:d.localConfig.reverse},d.ajaxConfig,c).then(function(a){a.identityToken===c&&(d.items.list=a.items,d.items.paging.totalPages=a.totalPages,d.items.paging.currentPage=a.currentPage,d.localConfig.pagingArray=a.pagingArray,d.localConfig.loadingData=!1)},function(){d.localConfig.loadingData=!1})}),d.loadNextPage=function(){d.localConfig.loadingData||d.items.paging.currentPage+1<=d.items.paging.totalPages&&d.loadPage(d.items.paging.currentPage+1)},d.loadPreviousPage=function(){d.localConfig.loadingData||d.items.paging.currentPage-1>0&&d.loadPage(d.items.paging.currentPage-1)},d.loadLastPage=function(){d.localConfig.loadingData||d.items.paging.currentPage!==d.items.paging.totalPages&&d.loadPage(d.items.paging.totalPages)},d.pageSizeChanged=function(a){Number(a)!==d.items.paging.pageSize&&(d.items.paging.pageSize=Number(a),d.loadPage(1))},d.sortByColumn=function(a){a.sortKey&&(a.sortKey!==d.localConfig.predicate?(d.localConfig.predicate=a.sortKey,d.localConfig.reverse=!0):d.localConfig.reverse===!0?d.localConfig.reverse=!1:(d.localConfig.reverse=n,d.localConfig.predicate=n),d.loadPage(d.items.paging.currentPage))},d.loadPage(1),g.$watch(p.ajaxConfig,function(){d.loadPage(1)},!0),p.tableClasses=p.tableClasses||"table",p.paginationBtnGroupClasses=p.paginationBtnGroupClasses||"btn-group btn-group-sm",u=u.replace(/%=tableName%/g,p.tableName).replace(/%=columnDefinition%/g,p.columnDefinition).replace(/%=tableClasses%/g,p.tableClasses).replace(/%=paginationBtnGroupClasses%/g,p.paginationBtnGroupClasses).replace(/%=icon-firstPage%/g,i.iconClasses.firstPage).replace(/%=icon-previousPage%/g,i.iconClasses.previousPage).replace(/%=icon-nextPage%/g,i.iconClasses.nextPage).replace(/%=icon-lastPage%/g,i.iconClasses.lastPage).replace(/%=icon-sortAscending%/g,i.iconClasses.sortAscending).replace(/%=icon-sortDescending%/g,i.iconClasses.sortDescending).replace(/%=icon-sortable%/g,i.iconClasses.sortable),s.empty(),s.append(e(u)(g))}return{restrict:"E",link:g}}]),angular.module("adaptv.adaptStrap.tablelite",["adaptv.adaptStrap.utils"]).directive("adTableLite",["$parse","$http","$compile","$filter","$templateCache","$adConfig","adStrapUtils","adDebounce",function(a,e,t,i,o,r,l,g){function s(e,s,p){e[p.tableName]={items:{list:n,paging:{currentPage:1,totalPages:n,pageSize:n,pageSizes:a(p.pageSizes)()||[10,25,50]}},localConfig:{pagingArray:[]},applyFilter:l.applyFilter};var c=e[p.tableName],d=o.get("tablelite/tablelite.tpl.html");c.items.paging.pageSize=c.items.paging.pageSizes[0],c.loadPage=g(function(a){var n,t=(a-1)*c.items.paging.pageSize,o=t+c.items.paging.pageSize,r=i("orderBy")(e.$eval(p.localDataSource),c.localConfig.predicate,c.localConfig.reverse);c.items.list=r.slice(t,o),c.items.paging.currentPage=a,c.items.paging.totalPages=Math.ceil(e.$eval(p.localDataSource).length/c.items.paging.pageSize),c.localConfig.pagingArray=[];var l=5,g=a-Math.floor(l/2);for(n=g;a>=n;n++)n>0&&c.localConfig.pagingArray.push(n);for(;c.localConfig.pagingArray.length<l&&!(n>c.items.paging.totalPages);)c.localConfig.pagingArray.push(n),n++}),c.loadNextPage=function(){c.items.paging.currentPage+1<=c.items.paging.totalPages&&c.loadPage(c.items.paging.currentPage+1)},c.loadPreviousPage=function(){c.items.paging.currentPage-1>0&&c.loadPage(c.items.paging.currentPage-1)},c.loadLastPage=function(){c.localConfig.disablePaging||c.loadPage(c.items.paging.totalPages)},c.pageSizeChanged=function(a){c.items.paging.pageSize=a,c.loadPage(1)},c.sortByColumn=function(a){a.sortKey&&(a.sortKey!==c.localConfig.predicate?(c.localConfig.predicate=a.sortKey,c.localConfig.reverse=!0):c.localConfig.reverse===!0?c.localConfig.reverse=!1:(c.localConfig.reverse=n,c.localConfig.predicate=n),c.loadPage(c.items.paging.currentPage))},c.loadPage(1),p.tableClasses=p.tableClasses||"table",p.paginationBtnGroupClasses=p.paginationBtnGroupClasses||"btn-group btn-group-sm",d=d.replace(/%=tableName%/g,p.tableName).replace(/%=columnDefinition%/g,p.columnDefinition).replace(/%=paginationBtnGroupClasses%/g,p.paginationBtnGroupClasses).replace(/%=tableClasses%/g,p.tableClasses).replace(/%=icon-firstPage%/g,r.iconClasses.firstPage).replace(/%=icon-previousPage%/g,r.iconClasses.previousPage).replace(/%=icon-nextPage%/g,r.iconClasses.nextPage).replace(/%=icon-lastPage%/g,r.iconClasses.lastPage).replace(/%=icon-sortAscending%/g,r.iconClasses.sortAscending).replace(/%=icon-sortDescending%/g,r.iconClasses.sortDescending).replace(/%=icon-sortable%/g,r.iconClasses.sortable),s.empty(),s.append(t(d)(e)),e.$watch(p.localDataSource,function(){c.loadPage(1)},!0)}return{restrict:"E",link:s}}]),angular.module("adaptv.adaptStrap.treebrowser",[]).directive("adTreeBrowser",["$compile","$http","$adConfig","$templateCache",function(a,e,n,t){return{restrict:"E",link:function(i,o,r){var l=r.treeName||"",g=r.nodeTemplateUrl||"",s=r.nodeHeaderUrl||"",p=r.childrenPadding||15,c="",d=function(e,g){var s=t.get("treebrowser/treebrowser.tpl.html");c=s.replace(/%=treeName%/g,l).replace(/%=treeRootName%/g,r.treeRoot).replace(/%=bordered%/g,r.bordered).replace(/%=icon-expand%/g,n.iconClasses.expand).replace(/%=icon-collapse%/g,n.iconClasses.collapse).replace(/%=icon-loadingSpinner%/g,n.iconClasses.loadingSpinner).replace(/%=childNodeName%/g,r.childNode).replace(/%=childrenPadding%/g,p).replace(/%=rowNgClass%/g,r.rowNgClass||"").replace(/%=nodeTemplate%/g,e).replace(/%=nodeHeaderTemplate%/g,g||""),o.empty(),o.append(a(c)(i))};i[l+"TreeBrowser"]={toggle:function(a,e){var n;a.stopPropagation(),n=i.$eval(r.toggleCallback),n?n(e):e._expanded=!e._expanded},hasChildren:function(a){var e=i.$eval(r.hasChildren),n=a[r.childNode]&&a[r.childNode].length>0;return e&&(n=e(a)),n},showHeader:""!==s?!0:!1},""!==g?e.get(g).success(function(a){""!==s?e.get(s).success(function(e){d(a,e)}):d(a,"")}):d('<span>{{ item.name || "" }}</span>')}}}]),angular.module("adaptv.adaptStrap.utils",[]).factory("adStrapUtils",["$filter",function(a){return{evalObjectProperty:function(a,e){var n=e.split(".");if(a)for(;n.length;)a&&(a=a[n.shift()]);return a},applyFilter:function(e,n){var t,i;return n&&(t=n.split(":"),i=t[1],e=i?a(t[0])(e,i):a(t[0])(e)),e}}}]).factory("adDebounce",["$timeout","$q",function(a,e){var n=function(n,t,i,o){var r=null,l=e.defer(),g=t||300;return function(){var t=o||this,s=arguments,p=i&&!r,c=function(){i||(l.resolve(n.apply(t,s)),l=e.defer())};return r&&a.cancel(r),r=a(c,g),p&&(l.resolve(n.apply(t,s)),l=e.defer()),l.promise}};return n}]).factory("adLoadPage",["$adConfig","$http","adStrapUtils",function(a,e,n){return function(t,i,o,r,l){var g=(t-1)*i,s=angular.copy(a.paging),p=angular.copy(r);p.paginationConfig&&p.paginationConfig.request&&angular.extend(s.request,p.paginationConfig.request),p.paginationConfig&&p.paginationConfig.response&&angular.extend(s.response,p.paginationConfig.response),p.params[s.request.start]=g,p.params[s.request.pageSize]=i,p.params[s.request.page]=t,o.field&&(p.params[s.request.sortField]=o.field),o.reverse===!1?p.params[s.request.sortDirection]=s.request.sortAscValue:o.reverse===!0&&(p.params[s.request.sortDirection]=s.request.sortDescValue);var c;return c="JSONP"===p.method?e.jsonp(p.url+"?callback=JSON_CALLBACK",p):e(p),c.then(function(a){for(var e={items:n.evalObjectProperty(a.data,s.response.itemsLocation),currentPage:t,totalPages:Math.ceil(n.evalObjectProperty(a.data,s.response.totalItems)/i),pagingArray:[],identityToken:l},o=5,r=t-Math.floor(o/2),g=r;t>=g;g++)g>0&&e.pagingArray.push(g);for(;e.pagingArray.length<o&&!(g>e.totalPages);)e.pagingArray.push(g),g++;return e})}}])}(window,document);